schema: '2.0'
stages:
  gamelog_data_acquisition:
    cmd: python3 -m src.exctract.gamelog_data_acquisition --config=params.yaml
    deps:
    - path: src/exctract/gamelog_data_acquisition.py
      hash: md5
      md5: 5de16521cd47e29f4711f5c5bdb65e6e
      size: 1921
    params:
      params.yaml:
        base:
          log_level: INFO
        gamelog_data_acquisition:
          season: 2010
          team: all
          data_type: gamelog
          output_folder: pipeline_output/gamelog
  schedule_data_acquisition:
    cmd: python3 -m src.exctract.schedule_data_acquisition --config=params.yaml
    deps:
    - path: src/exctract/schedule_data_acquisition.py
      hash: md5
      md5: 32e769b8f4ebd6d1a8f761364035c739
      size: 1934
    params:
      params.yaml:
        base:
          log_level: INFO
        schedule_data_acquisition:
          season: 2010
          team: all
          data_type: schedule
          output_folder: pipeline_output/schedule
  player_attributes_data_acquisition:
    cmd: python3 -m src.exctract.player_attributes_data_acquisition --config=params.yaml
    deps:
    - path: src/exctract/player_attributes_data_acquisition.py
      hash: md5
      md5: ed2942ad0b4297e24c26f326720eff4a
      size: 2051
    params:
      params.yaml:
        base:
          log_level: INFO
        player_attributes_data_acquisition:
          season: 2024
          team: all
          data_type: player_attributes
          output_folder: pipeline_output/player_attributes
  player_salary_data_acquisition:
    cmd: python3 -m src.exctract.player_salary_data_acquisition --config=params.yaml
    deps:
    - path: src/exctract/player_salary_data_acquisition.py
      hash: md5
      md5: 0b766b33e3db73b61884252e9df77417
      size: 4422
    params:
      params.yaml:
        base:
          log_level: INFO
        player_salary_data_acquisition:
          season: 2024
          data_type: player_salary
          output_folder: pipeline_output/player_salary
  gamelog_schedule_unification:
    cmd: python3 -m src.transform.gamelog_schedule_unification --config=params.yaml
    deps:
    - path: src/transform/gamelog_schedule_unification.py
      hash: md5
      md5: 550c620fa6c3f1f88d2ee12387d881aa
      size: 2363
    params:
      params.yaml:
        base:
          log_level: INFO
        gamelog_schedule_unification:
          data_path: pipeline_output/final/
          file_name: nba_games_training_dataset
  player_attributes_salaries_unification:
    cmd: python3 -m src.transform.player_attributes_salaries_unification --config=params.yaml
    deps:
    - path: src/transform/player_attributes_salaries_unification.py
      hash: md5
      md5: db69057207ecb219595a685e13478e4f
      size: 4653
    params:
      params.yaml:
        base:
          log_level: INFO
        player_attributes_salaries_unification:
          data_path: pipeline_output/final/
          file_name: player_attributes_salaries_dataset
  get_training_dataset:
    cmd:
    - aws s3 cp s3://foreshadownba/dvc-data-pipeline-output/nba_games_training_dataset_final.csv
      ./data/input/nba_games_training_dataset_final.csv
    outs:
    - path: ./data/input/nba_games_training_dataset_final.csv
      hash: md5
      md5: 4ca5cf7109bf2a2729f7df9650bcf505
      size: 13554549
  pre_cleaning_dataset:
    cmd: python3 -m src.pre_cleaning_dataset --config=params.yaml
    deps:
    - path: ./data/input/nba_games_training_dataset.csv
      hash: md5
      md5: d867af8791f48c884dd6cae884f7962b
      size: 6680883
    - path: src/pre_cleaning_dataset.py
      hash: md5
      md5: 2e7c45d0deae5e635c141028c87f5aef
      size: 2187
    params:
      params.yaml:
        base:
          log_level: INFO
        get_training_dataset:
          nba_games_training_dataset: nba_games_training_dataset
          player_attributes_salaries_dataset: player_attributes_salaries_dataset
    outs:
    - path: ./data/processed/nba_games_training_dataset_pre_cleaned.csv
      hash: md5
      md5: 058b9a51d277fbad55a0b4cbeedcc839
      size: 2559722
  previous_games_average_features:
    cmd: python3 -m src.previous_games_average_features --config=params.yaml
    deps:
    - path: src/previous_games_average_features.py
      hash: md5
      md5: b5d2a97c8939937949b5e36d36d2e23a
      size: 3901
    params:
      params.yaml:
        base:
          log_level: INFO
        get_training_dataset:
          nba_games_training_dataset: nba_games_training_dataset
          player_attributes_salaries_dataset: player_attributes_salaries_dataset
    outs:
    - path: ./data/processed/nba_games_training_dataset_previous_games_features.csv
      hash: md5
      md5: 8cf557557a1af1b8c7988dc3b6eb6620
      size: 57972848
  elo_features:
    cmd: python3 -m src.elo_features --config=params.yaml
    deps:
    - path: src/elo_features.py
      hash: md5
      md5: 06b6fce8f72f1408d03de4076ea0ed93
      size: 8603
    params:
      params.yaml:
        base:
          log_level: INFO
        get_training_dataset:
          nba_games_training_dataset: nba_games_training_dataset
          player_attributes_salaries_dataset: player_attributes_salaries_dataset
    outs:
    - path: ./data/processed/nba_games_training_dataset_elo_features.csv
      hash: md5
      md5: cf59aeb8577a6b3145e5b1955e3300ce
      size: 116550825
  previous_games_ratio_average_features:
    cmd: python3 -m src.previous_games_ratio_average_features --config=params.yaml
    deps:
    - path: src/previous_games_ratio_average_features.py
      hash: md5
      md5: 81b2a5ee62be721fd4fd6ffca1728ada
      size: 3838
    params:
      params.yaml:
        base:
          log_level: INFO
        get_training_dataset:
          nba_games_training_dataset: nba_games_training_dataset
          player_attributes_salaries_dataset: player_attributes_salaries_dataset
  features_engineering_pipeline:
    cmd: python3 -m src.features_engineering --config=params.yaml
    deps:
    - path: ./data/processed/nba_games_training_dataset_pre_cleaned.csv
      hash: md5
      md5: 058b9a51d277fbad55a0b4cbeedcc839
      size: 2559722
    - path: src/features_engineering.py
      hash: md5
      md5: 356289c6c91ddd18476197a3bd4211b2
      size: 3853
    params:
      params.yaml:
        base:
          log_level: INFO
        get_training_dataset:
          nba_games_training_dataset: nba_games_training_dataset
          player_attributes_salaries_dataset: player_attributes_salaries_dataset
    outs:
    - path: ./data/processed/nba_games_training_dataset_cleaned_w_features.csv
      hash: md5
      md5: 35db2fc8a5e8c0b43dc34609a0e55898
      size: 13684344
  get_y_variables:
    cmd: python3 -m src.get_y_variables --config=params.yaml
    deps:
    - path: ./data/processed/nba_games_training_dataset_cleaned_w_features.csv
      hash: md5
      md5: 35db2fc8a5e8c0b43dc34609a0e55898
      size: 13684344
    - path: src/get_y_variables.py
      hash: md5
      md5: 047af8ec7baaae1fb4d25a13951d54e7
      size: 4148
    params:
      params.yaml:
        base:
          log_level: INFO
        get_training_dataset:
          nba_games_training_dataset: nba_games_training_dataset
          player_attributes_salaries_dataset: player_attributes_salaries_dataset
    outs:
    - path: ./data/processed/nba_games_training_dataset_final.csv
      hash: md5
      md5: f3628c981082460b20c1cfb06eef601b
      size: 13944303
  load_training_dataset_to_db:
    cmd: python3 -m src.load_training_dataset_to_db --config=params.yaml
    deps:
    - path: ./data/output/nba_games_training_dataset_final_post_cleaned.csv
      hash: md5
      md5: 4daa6a38fea319b50ed931e83c5ac4c5
      size: 12380255
    - path: src/load_training_dataset_to_db.py
      hash: md5
      md5: 21f46fa93616623730ee89d7f6b06ca5
      size: 2606
    params:
      params.yaml:
        base:
          log_level: INFO
        get_training_dataset:
          nba_games_training_dataset: nba_games_training_dataset
          player_attributes_salaries_dataset: player_attributes_salaries_dataset
  post_cleaning_dataset:
    cmd: python3 -m src.post_cleaning_dataset --config=params.yaml
    deps:
    - path: ./data/processed/nba_games_training_dataset_final.csv
      hash: md5
      md5: f3628c981082460b20c1cfb06eef601b
      size: 13944303
    - path: src/post_cleaning_dataset.py
      hash: md5
      md5: da290cd307ae5d8aa1883bc99960bea6
      size: 1842
    params:
      params.yaml:
        base:
          log_level: INFO
        get_training_dataset:
          nba_games_training_dataset: nba_games_training_dataset
          player_attributes_salaries_dataset: player_attributes_salaries_dataset
    outs:
    - path: ./data/output/nba_games_training_dataset_final_post_cleaned.csv
      hash: md5
      md5: 4daa6a38fea319b50ed931e83c5ac4c5
      size: 12380255
  training_dataset_assessment:
    cmd: python3 -m src.training_dataset_assessment --config=params.yaml
    deps:
    - path: ./data/output/nba_games_training_dataset_final_post_cleaned.csv
      hash: md5
      md5: 4daa6a38fea319b50ed931e83c5ac4c5
      size: 12380255
    - path: src/training_dataset_assessment.py
      hash: md5
      md5: abb98e97971c39c668e37ba8fd8707f8
      size: 38817
    params:
      params.yaml:
        base:
          log_level: INFO
        get_training_dataset:
          nba_games_training_dataset: nba_games_training_dataset
          player_attributes_salaries_dataset: player_attributes_salaries_dataset
  data_split:
    cmd: python -m src.data_split --config=params.yaml
    deps:
    - path: ./data/processed/nba_training_dataset_processed.csv
      hash: md5
      md5: 4ca5cf7109bf2a2729f7df9650bcf505
      size: 13554549
    - path: src/data_split.py
      hash: md5
      md5: e3d797c10c7a557b399a96111068696e
      size: 1888
    params:
      params.yaml:
        base:
          log_level: INFO
          random_state: 42
        data_split:
          split_ratio: 0.33
          group_cv_variable: id
        get_training_dataset:
          training_dataset: data/input/nba_games_training_dataset_final.csv
    outs:
    - path: ./data/processed/test_dataset.csv
      hash: md5
      md5: e76d36a160eb00bc71f0ef98971152ed
      size: 4466276
    - path: ./data/processed/train_dataset.csv
      hash: md5
      md5: e98834df0accf265f169cd3405a4bd68
      size: 9089575
  dummy_and_baseline_classifier:
    cmd: python -m src.dummy_and_baseline_classifier --config=params.yaml
    deps:
    - path: ./data/processed/test_dataset.csv
      hash: md5
      md5: 00d4172767ebf694326577838a50fa0d
      size: 3997333
    - path: ./data/processed/train_dataset.csv
      hash: md5
      md5: 813e23614b3d6a9519470b26e3bc21b8
      size: 8101111
    - path: src/dummy_and_baseline_classifier.py
      hash: md5
      md5: 8403a816c045db109af653335e07eb22
      size: 3729
    params:
      params.yaml:
        base:
          log_level: INFO
          random_state: 42
        data_split:
          split_ratio: 0.33
          group_cv_variable: id
        dummy_classifier:
          target_variable: results
        get_training_dataset:
          training_dataset: data/input/nba_training_dataset.csv
    outs:
    - path: ./data/reports/baseline_classifier_metrics.json
      hash: md5
      md5: c2f3d2d4bae33f7310bdd42e0236b3bf
      size: 135
  initial_multiple_models_training:
    cmd: python -m src.initial_multiple_models_training --config=params.yaml
    deps:
    - path: ./data/processed/test_dataset_fs.csv
      hash: md5
      md5: 0f8f750f2abf0c8007f2cc34615ec780
      size: 1116852
    - path: ./data/processed/train_dataset_fs.csv
      hash: md5
      md5: f1a66fd9ed45dc2308c5b4670aa3bd30
      size: 2276874
    - path: src/initial_multiple_models_training.py
      hash: md5
      md5: cf67290f1c418472f5c1f5afb7df3ab4
      size: 3452
    params:
      params.yaml:
        base:
          log_level: INFO
          random_state: 42
        data_split:
          split_ratio: 0.33
          group_cv_variable: id
        initial_multiple_models_training:
          random_state: 21
          cross_validation_n_splits: 5
    outs:
    - path: data/processed/top_3_models.csv
      hash: md5
      md5: 837b7930c007cd40aeabbb9a9d75e68b
      size: 64
  train:
    cmd: python -m src.train --config=params.yaml
    deps:
    - path: ./data/processed/train_dataset_fs.csv
      hash: md5
      md5: f1a66fd9ed45dc2308c5b4670aa3bd30
      size: 2276874
    - path: src/train.py
      hash: md5
      md5: dce79a06d700f038988c2c2bf6e9d69b
      size: 2689
    - path: src/training/train_cross_val.py
      hash: md5
      md5: 8a151ce8912f0756b55c8e4adfebaf3d
      size: 4161
    params:
      params.yaml:
        base:
          log_level: INFO
          random_state: 42
        data_split:
          split_ratio: 0.33
          group_cv_variable: id
        initial_multiple_models_training:
          random_state: 21
          cross_validation_n_splits: 5
        train:
          top_3_models: data/processed/top_3_models.csv
          model_name: Extreme Gradient Boosting
          cross_validation_n_splits: 10
          scoring_metric: accuracy
          param_grid:
            max_depth: 4
            n_estimators: 1000
            learning_rate: 0.01
    outs:
    - path: ./models/cross_val_pred.csv
      hash: md5
      md5: 41d35802e714b8d714a9233cece21e15
      size: 1369248
    - path: ./models/cross_val_score.csv
      hash: md5
      md5: 42b359621ade9c992a14876687923b9f
      size: 8788
    - path: ./models/model.joblib
      hash: md5
      md5: 57093c3e59fcb34357c01b6f44686c07
      size: 1692831
  feature_selection:
    cmd: python -m src.feature_selection --config=params.yaml
    deps:
    - path: ./data/processed/test_dataset.csv
      hash: md5
      md5: e76d36a160eb00bc71f0ef98971152ed
      size: 4466276
    - path: ./data/processed/train_dataset.csv
      hash: md5
      md5: e98834df0accf265f169cd3405a4bd68
      size: 9089575
    - path: src/feature_selection.py
      hash: md5
      md5: 686136bd8f1cffb2c8120448c71c044b
      size: 5194
    params:
      params.yaml:
        base:
          log_level: INFO
          random_state: 42
        data_split:
          split_ratio: 0.33
          group_cv_variable: id
        dummy_classifier:
          target_variable: results
        feature_selection:
          method: manual
          list_nb_feature_to_select: 5/7/9
          rfe_step: 10
          cross_validation_n_splits: 5
          random_state: 21
          features_to_force:
          list_manual_features_to_select:
          - game_nb
          - before_average_W_ratio
          - before_average_W_ratio_opp
          - extdom_ext
          - rest
          - before_average_pts_tm
          - before_average_pts_opp
          - before_average_pts_tm_opp
          - before_average_pts_opp_opp
        get_training_dataset:
          training_dataset: data/input/nba_games_training_dataset_final.csv
    outs:
    - path: ./data/processed/columns_selected.csv
      hash: md5
      md5: 1c693c4651cd7860b51fa47a1b3f4a80
      size: 193
    - path: ./data/processed/test_dataset_fs.csv
      hash: md5
      md5: 0f8f750f2abf0c8007f2cc34615ec780
      size: 1116852
    - path: ./data/processed/train_dataset_fs.csv
      hash: md5
      md5: f1a66fd9ed45dc2308c5b4670aa3bd30
      size: 2276874
  evaluate:
    cmd: python3 -m src.evaluate --config=params.yaml
    deps:
    - path: ./data/processed/test_dataset_fs.csv
      hash: md5
      md5: 0f8f750f2abf0c8007f2cc34615ec780
      size: 1116852
    - path: ./data/reports/baseline_classifier_metrics.json
      hash: md5
      md5: a72eb2c86e31cd94f7d927ffc2c6a353
      size: 67
    - path: ./models/cross_val_score.csv
      hash: md5
      md5: 42b359621ade9c992a14876687923b9f
      size: 8788
    - path: src/evaluate.py
      hash: md5
      md5: 11b91d575bfd682a19808446a0e8f9f4
      size: 8342
    params:
      params.yaml:
        base:
          log_level: INFO
          random_state: 42
        data_split:
          split_ratio: 0.33
          group_cv_variable: id
        evaluate:
          metrics_path: data/reports/metrics.json
          shap_beeswarm_image: shap_beeswarm.png
          shap_plot_bar_image: shap_plot_bar.png
        train:
          top_3_models: data/processed/top_3_models.csv
          model_name: Extreme Gradient Boosting
          cross_validation_n_splits: 10
          scoring_metric: accuracy
          param_grid:
            max_depth: 4
            n_estimators: 1000
            learning_rate: 0.01
    outs:
    - path: ./models/test_df_w_pred.csv
      hash: md5
      md5: adfc04dd2a01d06c982f71e8be9fecdc
      size: 674803
    - path: data/reports/ConfusionMatrix.png
      hash: md5
      md5: 14a98fc04c3842c24a516ba2c360ba32
      size: 17094
    - path: data/reports/bar_plot_data.csv
      hash: md5
      md5: b0f74d10f2b39ed86febfec6c8e6de32
      size: 163
    - path: data/reports/metrics.json
      hash: md5
      md5: 9e7710d8f537fa7e304eecdf586edbb6
      size: 183
    - path: data/reports/shap_beeswarm.png
      hash: md5
      md5: cc468c25ee405083ddd792f060980562
      size: 111114
    - path: data/reports/shap_plot_bar.png
      hash: md5
      md5: a0d30e8b599171657499501d55ddc744
      size: 48621
  data_process:
    cmd: python -m src.data_process --config=params.yaml
    deps:
    - path: ./data/input/nba_games_training_dataset_final.csv
      hash: md5
      md5: 4ca5cf7109bf2a2729f7df9650bcf505
      size: 13554549
    - path: src/data_process.py
      hash: md5
      md5: ba86fc58cc64f54aa90fbdeb697ed91a
      size: 1115
    params:
      params.yaml:
        base:
          log_level: INFO
          random_state: 42
        data_process:
          training_dataset_processed: data/processed/nba_training_dataset_processed.csv
        get_training_dataset:
          training_dataset: data/input/nba_games_training_dataset_final.csv
    outs:
    - path: ./data/processed/nba_training_dataset_processed.csv
      hash: md5
      md5: 4ca5cf7109bf2a2729f7df9650bcf505
      size: 13554549
  baseline_classifier:
    cmd: python -m src.baseline_classifier --config=params.yaml
    deps:
    - path: ./data/processed/test_dataset.csv
      hash: md5
      md5: e76d36a160eb00bc71f0ef98971152ed
      size: 4466276
    - path: ./data/processed/train_dataset.csv
      hash: md5
      md5: e98834df0accf265f169cd3405a4bd68
      size: 9089575
    - path: src/baseline_classifier.py
      hash: md5
      md5: 08198825061539772b047bdb1c56cc2b
      size: 2804
    params:
      params.yaml:
        base:
          log_level: INFO
          random_state: 42
        data_split:
          split_ratio: 0.33
          group_cv_variable: id
        dummy_classifier:
          target_variable: results
        get_training_dataset:
          training_dataset: data/input/nba_games_training_dataset_final.csv
    outs:
    - path: ./data/reports/baseline_classifier_metrics.json
      hash: md5
      md5: a72eb2c86e31cd94f7d927ffc2c6a353
      size: 67
  write_final_model_to_s3:
    cmd:
    - aws s3 cp ./models/model.joblib s3://foreshadownba/dvc-ml-pipeline-output/ --profile=ipfy
    - aws s3 cp ./models/cross_val_pred.csv s3://foreshadownba/dvc-ml-pipeline-output/
      --profile=ipfy
    - aws s3 cp ./data/processed/columns_selected.csv s3://foreshadownba/dvc-ml-pipeline-output/
      --profile=ipfy
    deps:
    - path: ./data/processed/columns_selected.csv
      hash: md5
      md5: 1c693c4651cd7860b51fa47a1b3f4a80
      size: 193
    - path: ./models/
      hash: md5
      md5: 6f088a9b0ecc51f0785fef37b646f2f2.dir
      size: 3745774
      nfiles: 5
